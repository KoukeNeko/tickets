---
import Layout from "../layouts/Layout.astro";
import * as i18n from "src/i18n";
import Nav from "../components/Nav.astro";
const lang = i18n.local(Astro.url.pathname);
const t = i18n.t(lang, {
	login: {
		"zh-Hant": "登入／註冊",
		"zh-Hans": "登录／注册",
		en: "Login / Register"
	},
	continue: {
		"zh-Hant": "繼續",
		"zh-Hans": "继续",
		en: "Continue"
	}
});
const l = i18n.l(Astro.url);
---

<Layout i18n={t.t} path="" title={t.title} theme="#FFF" lang={lang}>
	<Nav />
	<main transition:animate="fade">
		<section>
			<div class="login-container" id="magic-link-form">
				<h1>{t.login}</h1>
				<label for="email">Email</label>
				<input type="email" name="email" id="email" />
				<button id="submit-btn" class="button" type="submit" onclick="test()">Continue</button>
			</div>
		</section>
	</main>

	<style>
		main {
			display: flex;
			flex-direction: column;
			min-height: 100vh;
		}
		h1 {
			margin-block: 1rem;
			text-align: center;
		}
		label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: bold;
		}
		input {
			border: 2px solid var(--black);
			width: 20rem;
			padding: 0.5rem;
		}
		section {
			flex-grow: 1;
			display: flex;
			flex-direction: column;
			justify-content: center;
			padding-bottom: 5rem;
		}

		.login-container {
			margin: 2rem auto;
			width: fit-content;
		}

		.button {
			margin: 1rem auto;
		}
	</style>

	<script>
		// 以下的 code 根本不會 work，可以全部砍掉 -ns
		const test = () => {
			console.log("test");
		};
		import { authClient } from "../lib/auth-client.js";

		document.addEventListener("DOMContentLoaded", function () {
			const form = document.getElementById("magic-link-form");
			const submitBtn = document.getElementById("submit-btn");

			form.addEventListener("submit", async function (e) {
				e.preventDefault();

				const formData = new FormData(form as HTMLFormElement);
				const email = formData.get("email");

				(submitBtn as HTMLButtonElement).disabled = true;
				submitBtn.textContent = "Sending...";

				try {
					await authClient.signIn.magicLink({
						email: email as string,
						callbackURL: window.location.origin + "/"
					});
				} catch (error) {
					console.error("Magic link error:", error);
				} finally {
					(submitBtn as HTMLButtonElement).disabled = false;
					submitBtn.textContent = "Continue";
				}
			});
		});
	</script>
</Layout>
